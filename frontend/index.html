<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Consent dApp - Secure Health Data Management</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- Suppress Favicon Error -->
    <link rel="icon" href="data:,">
</head>
<body>
    <header class="app-header">
        <div class="container">
            <h1><span class="material-icons-outlined icon-header">health_and_safety</span> Patient Consent Management</h1>
            <div class="wallet-info">
                <button id="connectWalletBtn" class="btn btn-primary"><span class="material-icons-outlined">account_balance_wallet</span> Connect Wallet</button>
                <button id="disconnectWalletBtn" class="btn btn-warning" style="display: none;"><span class="material-icons-outlined">link_off</span> Disconnect</button>
                <p class="account-display">Account: <span id="connectedAccount" class="status-neutral">Not Connected</span></p>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="action-section card">
            <h2><span class="material-icons-outlined">person</span> Patient Actions (Acting as: <span class="walletAddress status-neutral">N/A</span>)</h2>

            <div class="action-subsection">
                <h3><span class="material-icons-outlined">note_add</span> 1. Add Health Record</h3>
                <div>
                    <label for="dataHash">Data IPFS Hash:</label>
                    <input type="text" id="dataHash" placeholder="e.g., ipfs://QmXo..." value="ipfs://exampleDataHash123">
                </div>
                <div>
                    <label for="metadataHash">Metadata IPFS Hash:</label>
                    <input type="text" id="metadataHash" placeholder="e.g., ipfs://QmYw..." value="ipfs://exampleMetaHash456">
                </div>
                <button id="addRecordBtn" class="btn btn-secondary"><span class="material-icons-outlined">add_circle_outline</span> Add Record</button>
                <p class="status-message">Record Status: <span id="recordStatus" class="status status-neutral"></span></p>
            </div>

            <div class="action-subsection">
                <h3><span class="material-icons-outlined">how_to_reg</span> 2. Grant Consent</h3>
                <div>
                    <label for="consentRecordId">Record ID:</label>
                    <input type="number" id="consentRecordId" value="1" min="1">
                </div>
                <div>
                    <label for="consentRole">Requestor Role:</label>
                    <input type="text" id="consentRole" placeholder="e.g., Doctor" value="Doctor">
                </div>
                <div>
                    <label for="consentRequestorId">Requestor Specific ID:</label>
                    <input type="text" id="consentRequestorId" placeholder="e.g., License123" value="License123">
                </div>
                <div>
                    <label for="consentAction">Action:</label>
                    <select id="consentAction">
                        <option value="0">Read (0)</option>
                        <option value="1">Copy (1)</option>
                    </select>
                </div>
                <div>
                    <label for="consentedPurposeId">Consented Purpose ID:</label>
                    <input type="number" id="consentedPurposeId" placeholder="e.g., 8 for Diagnosis" value="8" min="1">
                </div>
                <button id="grantConsentBtn" class="btn btn-secondary"><span class="material-icons-outlined">approval</span> Grant Consent</button>
                <p class="status-message">Consent Status: <span id="grantStatus" class="status status-neutral"></span></p>
            </div>

             <div class="action-subsection">
                <h3><span class="material-icons-outlined">block</span> 2.5. Revoke Consent</h3>
                <div>
                    <label for="revokeRecordId">Record ID:</label>
                    <input type="number" id="revokeRecordId" value="1" min="1">
                </div>
                <div>
                    <label for="revokeInternalCounter">Internal Consent Counter:</label>
                    <input type="number" id="revokeInternalCounter" value="1" min="1">
                </div>
                <button id="revokeConsentBtn" class="btn btn-warning"><span class="material-icons-outlined">cancel</span> Revoke Consent</button>
                <p class="status-message">Revoke Status: <span id="revokeStatus" class="status status-neutral"></span></p>
            </div>
        </section>

        <hr class="section-divider">

        <section class="action-section card">
            <h2><span class="material-icons-outlined">medical_services</span> Requestor Actions (Acting as: <span class="walletAddress status-neutral">N/A</span>)</h2>
            <div class="action-subsection">
                <h3><span class="material-icons-outlined">find_in_page</span> 3. Access Patient Record</h3>
                <div>
                    <label for="accessPatientAddress">Patient's Address:</label>
                    <input type="text" id="accessPatientAddress" placeholder="Patient's Ethereum Address">
                </div>
                <div>
                    <label for="accessRecordId">Record ID:</label>
                    <input type="number" id="accessRecordId" value="1" min="1">
                </div>
                <div>
                    <label for="accessRole">Your Role:</label>
                    <input type="text" id="accessRole" placeholder="e.g., Doctor" value="Doctor">
                </div>
                <div>
                    <label for="accessRequestorId">Your Specific ID:</label>
                    <input type="text" id="accessRequestorId" placeholder="e.g., License123" value="License123">
                </div>
                <div>
                    <label for="accessAction">Action:</label>
                    <select id="accessAction">
                        <option value="0">Read (0)</option>
                        <option value="1">Copy (1)</option>
                    </select>
                </div>
                <div>
                    <label for="accessPurposeId">Access Purpose ID:</label>
                    <input type="number" id="accessPurposeId" placeholder="e.g., 8 for Diagnosis" value="8" min="1">
                </div>
                <button id="accessRecordBtn" class="btn btn-secondary"><span class="material-icons-outlined">visibility</span> Request & Access Record</button>
                <p class="status-message">Access Result: <span id="accessResult" class="status status-neutral"></span></p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Patient Consent dApp. Secure and Transparent.</p>
        </div>
    </footer>

    <!-- Use a reliable CDN for ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
